// Motwin - javascript-sdk 3.3.1.RELEASE - revision 39842
(function() {function m(y){throw y;}var o=void 0,p=!0,q=null,u=!1;function v(){return function(){}}function A(y){return function(){return this[y]}}var D=window;
function G(){var y,n;(function(a){function e(c,d){var h,a,b,f,e,g,j,i,t,l=d&&d.split("/"),k=r.map,s=k&&k["*"]||{};if(c&&"."===c.charAt(0))if(d){l=l.slice(0,l.length-1);c=l.concat(c.split("/"));for(i=0;i<c.length;i+=1)if(h=c[i],"."===h)c.splice(i,1),i-=1;else if(".."===h)if(1===i&&(".."===c[2]||".."===c[0]))break;else 0<i&&(c.splice(i-1,2),i-=2);c=c.join("/")}else 0===c.indexOf("./")&&(c=c.substring(2));if((l||s)&&k){h=c.split("/");for(i=h.length;0<i;i-=1){a=h.slice(0,i).join("/");if(l)for(t=l.length;0<
t;t-=1)if(b=k[l.slice(0,t).join("/")])if(b=b[a]){f=b;e=i;break}if(f)break;!g&&s&&s[a]&&(g=s[a],j=i)}!f&&g&&(f=g,e=j);f&&(h.splice(0,e,f),c=h.join("/"))}return c}function b(c,d){return function(){return l.apply(a,w.call(arguments,0).concat([c,d]))}}function f(c){return function(d){return e(d,c)}}function k(c){return function(d){i[c]=d}}function h(c){if(x.call(s,c)){var d=s[c];delete s[c];z[c]=p;g.apply(a,d)}!x.call(i,c)&&!x.call(z,c)&&m(Error("No "+c));return i[c]}function j(c){var d,h=c?c.indexOf("!"):
-1;-1<h&&(d=c.substring(0,h),c=c.substring(h+1,c.length));return[d,c]}function d(c){return function(){return r&&r.zb&&r.zb[c]||{}}}var g,l,c,t,i={},s={},r={},z={},x=Object.prototype.hasOwnProperty,w=[].slice;c=function(c,d){var a,b=j(c),g=b[0],c=b[1];g&&(g=e(g,d),a=h(g));g?c=a&&a.normalize?a.normalize(c,f(d)):e(c,d):(c=e(c,d),b=j(c),g=b[0],c=b[1],g&&(a=h(g)));return{Gc:g?g+"!"+c:c,le:c,Ve:g,Uc:a}};t={Ie:function(c){return b(c)},za:function(c){var d=i[c];return"undefined"!==typeof d?d:i[c]={}},ke:function(c){return{id:c,
uri:"",za:i[c],zb:d(c)}}};g=function(d,f,g,e){var j,l,r,w,n=[],F,e=e||d;if("function"===typeof g){f=!f.length&&g.length?["require","exports","module"]:f;for(w=0;w<f.length;w+=1)r=c(f[w],e),l=r.Gc,"require"===l?n[w]=t.Ie(d):"exports"===l?(n[w]=t.za(d),F=p):"module"===l?j=n[w]=t.ke(d):x.call(i,l)||x.call(s,l)||x.call(z,l)?n[w]=h(l):r.Uc?(r.Uc.load(r.le,b(e,p),k(l),{}),n[w]=i[l]):m(Error(d+" missing "+l));f=g.apply(i[d],n);if(d)if(j&&j.za!==a&&j.za!==i[d])i[d]=j.za;else if(f!==a||!F)i[d]=f}else d&&(i[d]=
g)};y=l=function(d,b,f,e,j){if("string"===typeof d)return t[d]?t[d](b):h(c(d,b).Gc);d.splice||(r=d,b.splice?(d=b,b=f,f=q):d=a);b=b||v();"function"===typeof f&&(f=e,e=j);e?g(a,d,b,f):setTimeout(function(){g(a,d,b,f)},4);return l};l.zb=function(c){r=c;r.Wd&&l(r.Wd,r.Se);return l};n=function(c,d,h){d.splice||(h=d,d=[]);!x.call(i,c)&&!x.call(s,c)&&(s[c]=[c,d,h])};n.Re={Ue:p}})();n("libs/almond",v());n("externs/Console",[],function(){return window.console});n("sdk/utils/Logger",["externs/Console"],function(a){return{cb:3,
Pb:2,Qb:1,Ob:0,qa:this.cb,Ke:function(a){this.qa=a},debug:function(){this.qa>=this.cb&&a&&a.log&&a.log(this.La(arguments[0],Array.prototype.slice.call(arguments,1)))},info:function(){this.qa>=this.Pb&&a&&a.info&&a.info(this.La(arguments[0],Array.prototype.slice.call(arguments,1)))},warn:function(){this.qa>=this.Qb&&a&&a.warn&&a.warn(this.La(arguments[0],Array.prototype.slice.call(arguments,1)))},error:function(){this.qa>=this.Ob&&a&&a.error&&a.error(this.La(arguments[0],Array.prototype.slice.call(arguments,
1)))},La:function(e,b){return e.replace(/{(\d+)}/g,function(f,e){var h;if(b[e]&&"object"===typeof b[e]&&b[e]instanceof Error)try{h=b[e].message,b[e].stack&&a.error(b[e].stack)}catch(j){h=b[e]}else if(b[e]&&"object"===typeof b[e])try{h=b[e].toString!==Object.prototype.toString?b[e].toString():JSON.stringify(b[e])}catch(d){h=b[e]}else h=b[e]&&"function"==typeof b[e]?"function":b[e]?b[e]:f;h=""+h;return h.substring(0,Math.min(500,h.length))})}}});n("sdk/utils/Preconditions",["sdk/utils/Logger"],function(a){return{a:function(a,
b){if("undefined"==typeof a||a==q)b&&m(Error(b)),m(Error("value cannot be null"));return a},ya:function(e,b){this.a(e,"functionName cannot be null");this.a(b,"message cannot be null");a.warn("Deprecated: function '{0}' is deprecated because '{1}'.",e,b)},c:function(a,b){a||(b&&m(Error(b)),m(Error("expression is not valid")))},fa:function(a,b){a||(b&&m(Error(b)),m(Error("expression is not valid")))}}});n("sdk/utils/GUID",[],function(){return{Q:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},
random:function(){return this.Q()+this.Q()+"-"+this.Q()+"-"+this.Q()+"-"+this.Q()+"-"+this.Q()+this.Q()+this.Q()}}});n("externs/LocalStorage",[],function(){try{return window.localStorage}catch(a){}});n("externs/SessionStorage",[],function(){try{return window.sessionStorage}catch(a){}});n("externs/ObjectStorage",[],function(){var a=[],e={};return{length:a.length,setItem:function(b,f){-1==a.indexOf(b)&&a.push(b);e[b]=f},getItem:function(a){return e[a]},removeItem:function(b){var f=a.indexOf(b);-1!=
f&&(a.splice(f,1),delete e[b])},clear:function(){a=[];e={}}}});n("sdk/utils/Platform",["sdk/utils/GUID","externs/LocalStorage","externs/SessionStorage","externs/ObjectStorage"],function(a,e,b,f){return{Zd:function(){var k=e||b||f,h=k.getItem("motwin::deviceId");h||(h=a.random(),k.setItem("motwin::deviceId",h));return h},be:function(){return navigator.platform},ce:function(){return navigator.userAgent}}});n("sdk/utils/Callbacks",["sdk/utils/Preconditions","sdk/utils/Logger"],function(a,e){function b(a,
b){this.tb=u;this.Wb=b||this;this.X=[];this.Rd=a||u;this.yc=o}b.prototype={set:function(a){a instanceof Array||m(Error("value must be a Array"));if(!this.tb||this.Rd){var b=this.X.slice();this.tb=p;this.yc=a;for(var h=0,j=b.length;h<j;h++)try{var d=b[h];d&&d.apply(this.Wb,a)}catch(g){e.error("Unable to forward event: {0}",g)}}else m(Error("Callbacks is not updatable"))},add:function(b){a.a(b,"callback cannot be null");var e=this.X.length,h=this.X.push(b);this.tb&&e!=h&&b.apply(this.Wb,this.yc)},remove:function(b){a.a(b,
"listener cannot be null");for(var e=0,h=this.X.length;e<h;e++)this.X[e]==b&&this.X.splice(e,1)}};return b});n("sdk/network/Queue",["sdk/utils/Logger","sdk/utils/Preconditions"],function(a,e){function b(a){e.a(a,"messageProcessor cannot be null");this.lc=a;this.j=u;this.clear()}b.prototype={clear:function(){this.nb=[];this.la=this.pa=this.eb=this.xa=1},Sd:function(a){e.a(a,"message cannot be null");var b;b=this.pa;this.pa++;a.id=b;this.nb.push(a);this.j&&this.lc(a)},start:function(){for(var a=this.nc();a!=
q;)this.lc(a),a=this.nc();this.j=p},stop:function(){this.j=u},de:function(a){this.ad(a);this.xa=a},ad:function(a){var b;(a<this.la||a>this.pa)&&m(Error("Queue consistency problem with ack="+a+", upFirst="+this.la+", upLast="+this.pa));b=this.la;this.la=this.eb=a;for(var h=0;h<a-b;h++)this.nb.shift();this.xa<this.eb&&(this.xa=this.eb)},P:A("j"),nc:function(){for(var a=q;a==q&&this.xa<this.pa;)a=this.pd(this.xa++);return a},pd:function(a){var b=Date.now(),h=this.nb[a-this.la];h&&h.id!=a&&m(Error("Queue inconsistency"));
h&&0<h.ttl&&h.createdAt+h.ttl<b&&(h=q);return h}};return b});n("sdk/utils/Exporter",[],function(){return{Te:function(a,e,b){for(var e=e.split("."),f=0;f<e.length-1;f++)a=a[e[f]];this.b(a,e[e.length-1],b)},b:function(a,e,b){a[e]=b}}});n("sdk/utils/MotwinError",["sdk/utils/Preconditions","sdk/utils/Exporter"],function(a,e){function b(b,k,h,j,d){a.a(b,"source cannot be null");a.a(k,"type cannot be null");a.a(h,"message cannot be null");a.fa("client"==b||"server"==b,"source must be 'client' or 'server'");
a.fa("timeout"==k||"error"==k,"type must be 'timeout' or 'error'");this.ub=b;this.r=k;this.kc=h;this.ac=j||q;this.cc=d||u;e.b(this,"source",this.ub);e.b(this,"type",this.r);e.b(this,"message",this.kc);e.b(this,"error",this.ac)}b.prototype={ge:A("cc"),he:function(){return"server"==this.ub},ee:function(){return"client"==this.ub},ie:function(){return"timeout"==this.r},ae:A("kc"),getError:A("ac")};return b});n("sdk/utils/Listeners",["sdk/utils/Preconditions","sdk/utils/Logger"],function(a,e){function b(b){a.a(b,
"bind cannot be null");this.bd=b;this.ra=[]}b.prototype={g:function(){for(var a=this.ra.slice(),b=0,h=a.length;b<h;b++)try{var j=a[b];j&&j.apply(this.bd,arguments)}catch(d){e.error("Unable to forward event: {0}",d)}},add:function(b){a.a(b,"listener cannot be null");a.c(-1==this.ra.indexOf(b),"listener already exists");this.ra.push(b)},remove:function(b){a.a(b,"listener cannot be null");b=this.ra.indexOf(b);a.c(0<=b,"listener not exists");this.ra.splice(b,1)}};return b});n("sdk/utils/Deferred",[],
function(){function a(a,b){this.Od=a;this.od=b}a.prototype={te:function(a){this.Od.add(a);return this},K:function(a){this.od.add(a);return this}};return a});n("sdk/channel/ClientChannel","sdk/utils/Logger,sdk/utils/Preconditions,sdk/utils/Platform,sdk/utils/Callbacks,sdk/network/Queue,sdk/utils/MotwinError,sdk/utils/Listeners,sdk/utils/Deferred".split(","),function(a,e,b,f,k,h,j,d){function g(c,d,a,h){var g=this;g.name=g.e=++l;g.Ra=e.a(c,"uri cannot be null");g.p=e.a(d,"userInfo cannot be null");
g.dd=e.a(a,"connectorFactory cannot be null");g.ed=h;g.j=u;g.I=u;g.s=u;g.ca=q;g.W=1;g.oa=1E4;g.na=q;g.ta=q;g.D=q;g.rc=q;e.a(g.p.appName,"userInfo.appName cannot be null");e.a(g.p.appVersion,"userInfo.appVersion cannot be null");g.p.deviceType=g.p.deviceType||"HTML5";g.p.deviceId=g.p.deviceId||b.Zd();g.p.deviceSystem=g.p.deviceSystem||b.be();g.p.userAgent=g.p.userAgent||b.ce();g.p.deviceVersion=g.p.deviceVersion||"N/A";g.fc=function(){g.Jd()};g.ea=new k(function(c){g.uc(c)});g.sb=new j(g);g.rb=new j(g);
g.ib=new j(g);g.jb=new j(g);g.S=new j(g);g.xb=new j(g);g.Y={}}var l=0;g.prototype={Ud:function(){e.c(!this.j,"socket is already started");a.debug("ClientChannel({0}) connecting...",this.name);this.j=p;this.Xb();return this},Xd:function(){if(this.j){a.debug("ClientChannel({0}) disconnecting...",this.name);this.j=u;this.Ub();this.o&&this.o.Aa()&&this.o.close()}else a.debug("ClientChannel({0}) already disconnected.",this.name);return this},Yd:function(){e.ya("Call to ClientChannel.dispose() is no longer required.")},
P:A("j"),fe:A("s"),Mc:A("I"),re:function(c){e.a(c,"listener cannot be null");this.sb.add(c);return this},me:function(c){e.a(c,"listener cannot be null");this.sb.remove(c);return this},se:function(c){e.a(c,"listener cannot be null");this.rb.add(c);return this},ne:function(c){e.a(c,"listener cannot be null");this.rb.remove(c);return this},Rc:function(c){e.a(c,"listener cannot be null");this.ib.add(c);return this},Pc:function(c){e.a(c,"listener cannot be null");this.ib.remove(c);return this},Sc:function(c){e.a(c,
"listener cannot be null");this.jb.add(c);return this},Qc:function(c){e.a(c,"listener cannot be null");this.jb.remove(c);return this},we:function(c){e.a(c,"listener cannot be null");this.xb.add(c);return this},qe:function(c){e.a(c,"listener cannot be null");this.xb.remove(c);return this},K:function(c){e.a(c,"listener cannot be null");this.S.add(c);return this},Da:function(c){e.a(c,"listener cannot be null");this.S.remove(c);return this},Ga:function(c,d){e.a(c,"type cannot be null");e.a(d,"listener cannot be null");
a.debug("ClientChannel({0}) register message processor {1} for {2}...",this.name,d,c);this.Y[c]||(this.Y[c]=new j(this));this.Y[c].add(d);return this},Mb:function(c,d){e.a(c,"type cannot be null");e.a(d,"listener cannot be null");a.debug("ClientChannel({0}) unregister message processor {1} for {2}...",this.name,d,c);this.Y[c]&&this.Y[c].remove(d);return this},sendMessage:function(c,b,g){var g=g||{},j=new f(u,this),l=new f(u,this),z=g.guaranteedDelivery==u?u:p;e.a(c,"message type cannot be null");
e.c(this.I,"session must be opened to send a message");a.debug("ClientChannel({0}) sending message with type='{1}' and content='{2}'...",this.name,c,b);g={type:c,content:b===o?q:b,createdAt:Date.now(),ttl:g.ttl||0};try{z?this.ea.Sd(g):this.uc(g);a.debug("ClientChannel({0}) message type='{1}' and content='{2}' forwarded to the network stack.",this.name,c,b);j.set([g])}catch(k){a.error("ClientChannel({0}) message type='{1}' and content='{2}' cannot be forwarded to the network stack: {3}.",this.name,
c,b,k);l.set([g,new h("client","error","error sending message",k,p)])}return new d(j,l)},Kd:function(){e.c(!this.s,"session must not be connected");this.kb({status:{sessionId:this.ca,ack:this.W,protocolVersion:"1.2",userInfo:this.p}})},Jd:function(){e.c(this.I,"session must be open");e.c(this.s,"session must be connected");this.kb({heartbeat:{ack:this.W}})},uc:function(c){e.c(this.I,"session must not be opened");if(this.s){clearInterval(this.na);this.na=setInterval(this.fc,this.oa);this.kb({message:{id:c.id||
-1,ack:this.W,type:c.type,content:c.content}})}else a.debug("Message dropped because not connected: {1}",c)},pc:function(c,d){e.a(d,"notification cannot be null");a.debug("ClientChannel({0}) notified for update: Required is {1} and Notification is {2}.",this.name,c,d);this.xb.g(c,d)},xd:function(c){e.c(!this.s,"session must not be connected");clearTimeout(this.D);this.D=q;if(this.ca!=c.sessionId){this.ca=c.sessionId;this.oa=c.idleTime*1E3-5E3;this.I=p;this.W=1;this.ea.clear();e.c(this.oa>=5E3,"idleTime must be higher than 10 seconds");
var d={sessionId:c.sessionId,notification:c.notification};this.sb.g(d);a.debug("ClientChannel({0}) sessionOpened: {1}.",this.name,d)}this.s=p;this.na=setInterval(this.fc,this.oa);this.ea.de(c.ack);this.ea.start();a.debug("ClientChannel({0}) connected.",this.name);this.ib.g();c.notification&&this.pc(u,c.notification)},ud:function(){e.c(this.I,"session must be open");e.c(this.s,"session must be connected");this.ea.stop();this.s=u;clearInterval(this.na);this.na=q;a.debug("ClientChannel({0}) disconnected.",
this.name);this.jb.g()},yd:function(c){e.a(c,"rejectMessage cannot be null");clearTimeout(this.D);this.D=q;var d=this.ca;this.o&&this.o.Aa()&&this.o.close();this.I=u;this.ca=q;d={sessionId:d,notification:c.notification,code:c.code,reason:c.reason};if(c.code&&c.code!=2){a.debug("ClientChannel({0}) rejected: {1}.",this.name,d);this.rb.g(d);c.notification&&this.pc(p,c.notification)}},vd:function(c){e.a(c,"error cannot be null");clearTimeout(this.D);this.D=q;this.j=u;this.o&&this.o.Aa()&&this.o.close();
this.I=u;this.ca=q;a.error("ClientChannel({0}) error from network stack: {1}.",this.name,c);this.S.g(c)},wd:function(c){e.a(c,"message cannot be null");e.c(this.I,"session must be open");e.c(this.s,"session must be connected");if(c.id>=this.W)this.W=c.id+1;this.ea.ad(c.ack);a.debug("ClientChannel({0}) processMessage: {1}.",this.name,c);var d=this.Y[c.type];d&&d.g(c)},Xb:function(){var c=this;c.o=new c.dd(c.Ra,c.rc,{Tc:function(d){c.rc=d;c.j&&c.Kd()},closed:function(){c.Ub();c.o=q;c.s&&c.ud();c.j&&
c.Id()},Ec:function(d){d.message?c.wd(d.message):d.reject?c.yd(d.reject):d.ready?c.xd(d.ready):m(Error("unable to process received data"))},v:function(d){c.vd(d)}},c.ed);c.D=setTimeout(function(){e.c(!c.s,"Connection must be not connected to timeout.");c.o&&c.o.Aa()&&c.o.close()},c.oa)},Ub:function(){if(this.ta){clearTimeout(this.ta);this.ta=q}if(this.D){clearTimeout(this.D);this.D=q}},Id:function(){var c=this;c.ta=setTimeout(function(){c.Xb();c.ta=q},1E3)},kb:function(c){e.c(this.o,"connector cannot be null");
this.o.send(c)}};return g});n("sdk/streamdata/Query",["sdk/utils/Preconditions"],function(a){function e(a){var a=a.constructor.toString()+a.toString(),b=0;if(0==a.length)return b;for(var d=0;d<a.length;d++)b=(b<<5)-b+a.charCodeAt(d),b&=b;return b}function b(a,b){return typeof a==typeof b&&a==b}function f(a){var b=0,d=q;for(d in a)a.hasOwnProperty(d)&&b++;return b}function k(b,e,d){a.a(b,"query cannot be null");a.fa("string"===typeof b,"query must be a string");a.a(e,"positionalParameters cannot be null");
a.fa(e instanceof Array,"positionalParameters must be a array");a.a(d,"namedParameters cannot be null");a.fa("object"===typeof d,"namedParameters must be a object");var g=b.match(/\?/g),g=g==q?0:g.length;a.c(e.length==g,"Unexpected number of positional parameters : Expected "+g+" got "+e.length);var g=b.match(/:\b(\w*)\b/g),l=g==q?0:g.length;a.c(f(d)==l,"Unexpected number of named parameters : Expected "+l+" got "+f(d));for(var c in g)l=g[c].substring(1),a.c(d.hasOwnProperty(l),"Named parameter not found : expected "+
l+" not found in "+JSON.stringify(d));this.O=b;this.ba=e;this.Z=d}k.prototype={V:function(a){if(this===a)a=p;else if(!a||!(a instanceof k)||a.O!=this.O)a=u;else{var e;a:{e=a.Z;var d=this.Z,g;for(g in e)if(e.hasOwnProperty(g)&&(!d.hasOwnProperty(g)||!b(e[g],d[g]))){e=u;break a}for(g in d)if(d.hasOwnProperty(g)&&(!e.hasOwnProperty(g)||!b(e[g],d[g]))){e=u;break a}e=p}if(e)a:if(a=a.ba,e=this.ba,a.length!=e.length)e=u;else{for(d=0;d<a.length;d++)if(!b(a[d],e[d])){e=u;break a}e=p}a=e}return a},ga:function(){if(!this.ec){for(var a=
this.ba,b=0,d=0,g=a.length;d<g;d++)b=(b<<5)-b+e(a[d]);var a=e(this.O)+(b&b),g=this.Z,b=[],d=0,f;for(f in g)g.hasOwnProperty(f)&&b.push(e(f)+e(g[f]));b.sort();f=0;for(g=b.length;f<g;f++)d=(d<<5)-d+b[f];this.ec=a+d}return this.ec},toString:function(){return'Query["'+this.O+'", positionalParameters= '+JSON.stringify(this.ba)+", namedParameters="+JSON.stringify(this.Z)+"]"}};return k});n("sdk/streamdata/ContinuousQueryController",["sdk/streamdata/Query","sdk/utils/Preconditions","sdk/utils/Logger","sdk/utils/Listeners",
"sdk/utils/MotwinError"],function(a,e,b,f){function k(d){e.a(d,"continuousQueryController cannot be null");this.gd=d;this.m="";this.L=-1;this.ua=o;this.t=this.j=u;this.yb=new f(d);this.Bb=new f(d);this.Nb=new f(d);this.Cb=new f(d);this.Sa=new f(d);this.Ab=new f(d);this.Ha=new f(d);this.Fa=new f(d)}function h(d,b,h,c){e.a(d,"clientChannel cannot be null");e.a(b,"bucketRegistry cannot be null");e.a(h,"queryString cannot be null");this.name=++j;this.d=d;this.ia=b;this.f=new k(this);c&&c instanceof Array?
this.T=new a(h,c,{}):c&&"object"===typeof c?this.T=new a(h,[],c):(c&&m(Error("parameters must are included in a Array (ordered by position) or a Object (key: value)")),this.T=new a(h,[],{}))}e.a(b,"Logger must be defined");var j=0;k.prototype={w:A("ua"),Wa:A("t"),P:A("j"),je:function(){this.j=p},Oc:function(){this.j=u},Xc:function(d,a,b,c,e,h){this.ja(d,a);b>this.L&&this.Bb.g(c,e,h)},Ee:function(d,a,b,c,e,h,f){this.ja(d,a);b>this.L&&this.Nb.g(c,e,h,f)},De:function(d,a,b,c,e,h){this.ja(d,a);b>this.L&&
this.Cb.g(c,e,h)},Ce:function(d,a,b,c,e){this.ja(d,a);b>this.L&&this.Sa.g(c,e)},Vc:function(d,a,b,c,e){this.ja(d,a);b>this.L&&(this.ua=e,this.L=b,this.yb.g(c,e))},Yc:function(d){this.t=p;this.Ha.g(d)},Jb:function(d){this.t=u;this.Fa.g(d)},Wc:function(d,a){a.cc&&this.Oc();this.Ab.g(d,a)},ja:function(d,a){if(d!=this.m||a>this.L){if(this.ua)for(var b=this.ua.length-1;0<=b;b--)this.Sa.g({},b);this.m=d;this.L=a;this.ua=o}},toString:function(){return this.gd.name}};h.prototype={start:function(){e.c(!this.f.P(),
"controller is already started");b.debug("ClientChannel({0}) ContinuousQueryController({1}) with query '{2}' registering...",this.d.name,this.name,this.T);this.f.je();this.ia.start(this.T,this.f);return this},stop:function(){this.f.P()?(b.debug("ClientChannel({0}) ContinuousQueryController({1}) with query '{2}' unregistering...",this.d.name,this.name,this.T),this.f.Oc(),this.ia.stop(this.T,this.f)):b.debug("ClientChannel({0}) ContinuousQueryController({1}) with query '{2}' already stopped.",this.d.name,
this.name,this.T);return this},w:function(){return this.f.w()},P:function(){return this.f.P()},Wa:function(){return this.f.Wa()},Xa:function(d,a){e.a(d,"listener cannot be null");if(a){var b=this.f.w();b&&d({},b)}this.f.yb.add(d);return this},Db:function(d){e.a(d,"listener cannot be null");this.f.yb.remove(d);return this},K:function(d){e.a(d,"listener cannot be null");this.f.Ab.add(d);return this},Da:function(d){e.a(d,"listener cannot be null");this.f.Ab.remove(d);return this},Za:function(d,a){e.a(d,
"listener cannot be null");if(a){var b=this.f.w();if(b)for(var c=0,h=b.length;c<h;c++)d({},c,b[c])}this.f.Bb.add(d);return this},Fb:function(d){e.a(d,"listener cannot be null");this.f.Bb.remove(d);return this},ha:function(d){e.a(d,"listener cannot be null");this.f.Nb.add(d);return this},Ea:function(d){e.a(d,"listener cannot be null");this.f.Nb.remove(d);return this},$a:function(d){e.a(d,"listener cannot be null");this.f.Cb.add(d);return this},Gb:function(d){e.a(d,"listener cannot be null");this.f.Cb.remove(d);
return this},Ya:function(d){e.a(d,"listener cannot be null");this.f.Sa.add(d);return this},Eb:function(d){e.a(d,"listener cannot be null");this.f.Sa.remove(d);return this},ue:function(d){e.a(d,"listener cannot be null");e.ya("onSynchronize","replaced by onSync");this.f.Ha.add(d);return this},oe:function(d){e.a(d,"listener cannot be null");e.ya("offSynchronize","replaced by offSync");this.f.Ha.remove(d);return this},ve:function(d){e.a(d,"listener cannot be null");e.ya("onUnsynchronize","replaced by onOutOfSync");
this.f.Fa.add(d);return this},pe:function(d){e.a(d,"listener cannot be null");e.ya("offUnsynchronize","replaced by offOutOfSync");this.f.Fa.remove(d);return this},bb:function(d){e.a(d,"listener cannot be null");this.f.Ha.add(d);return this},Ib:function(d){e.a(d,"listener cannot be null");this.f.Ha.remove(d);return this},ab:function(d){e.a(d,"listener cannot be null");this.f.Fa.add(d);return this},Hb:function(d){e.a(d,"listener cannot be null");this.f.Fa.remove(d);return this}};return h});n("sdk/utils/Utils",
[],function(){"undefined"==typeof Date.now&&(Date.now=function(){return(new Date).getTime()});return{J:function(a){if(q==a||"object"!=typeof a)return a;var e=a.constructor(),b;for(b in a)a.hasOwnProperty(b)&&(e[b]=a[b]);return e},Fe:function(a,e){return function(){return a.apply(e,arguments)}},Ca:v(),Vd:function(a){var e=0;if(a.length==0)return e;for(var b=0;b<a.length;b++){e=(e<<5)-e+a.charCodeAt(b);e=e&e}return e}}});n("sdk/streamdata/WindowedContinuousQueryController",["sdk/utils/Preconditions",
"sdk/utils/Logger","sdk/utils/Listeners","sdk/utils/Utils"],function(a,e,b,f){function k(e,f,d,g){a.a(e,"controllerFactory cannot be null");a.a(f,"queryString cannot be null");a.a("string"===typeof f,"queryString must be a string");a.a(!f.search(/(OFFSET|LIMIT)/i),"queryString cannot contain OFFSET or LIMIT keywords");a.a(d,"windowSize cannot be null");this.hd=e;this.O=f.replace(/;$/i,"");this.U=d;this.sd=g;this.gb=new b(this);this.lb=new b(this);this.wb=new b(this);this.pb=new b(this);this.Ja=new b(this);
this.S=new b(this);this.vb=new b(this);this.qb=new b(this);this.B=0;this.Ma=this.z=-1;this.reset()}k.prototype={reset:function(){if(this.ka){this.stop();for(var a=this.w().length;0<=a;--a)this.Ja.g({},a)}this.ka=[];this.G(0);return this},bottom:function(){return 0<=this.z&&this.B<=this.z?this.G(this.z):q},top:function(){return 0<=this.B&&this.B<=this.z?this.G(this.B):q},G:function(b){a.a(b,"index cannot be null");a.c(b<=this.Ma+1,"invalid controller index");var e=this,d=e.ka[b];d||(d=e.hd(e.O+" LIMIT "+
e.U+" OFFSET "+e.U*b,e.sd),d.Xa(function(a){a=f.J(a);a.index=b;a.controller=d;e.gb.g(a,e.w());e.Ma<b&&(e.Ma=b)}),d.Za(function(a,l,c){a=f.J(a);a.index=b;a.controller=d;e.lb.g(a,b*e.U+l,c)}),d.ha(function(a,l,c,t){a=f.J(a);a.index=b;a.controller=d;e.wb.g(a,b*e.U+l,c,t)}),d.$a(function(a,l,c){a=f.J(a);a.index=b;a.controller=d;e.pb.g(a,b*e.U+l,b*e.U+c)}),d.Ya(function(a,l){var c=f.J(a);c.index=b;c.controller=d;e.Ja.g(c,b*e.U+l)}),d.bb(function(a){a=f.J(a);a.index=b;a.controller=d;e.vb.g(a)}),d.ab(function(a){a=
f.J(a);a.index=b;a.controller=d;e.qb.g(a)}),d.K(function(a,l){var c=f.J(a);c.index=b;c.controller=d;e.S.g(c,l)}),e.ka[b]=d);return d},Ne:function(){var a=0<=this.B-1;a&&this.G(--this.B).start();return a},Le:function(){var a=this.z<=this.Ma;a&&this.G(++this.z).start();return a},Pe:function(){var a=0<=this.B&&this.B<=this.z;a&&this.G(this.B++).stop();return a},Oe:function(){var a=this.z>=this.B&&0<=this.z;a&&this.G(this.z--).stop();return a},start:function(){for(var a=this.B;a<=this.z;a++)this.G(a).start();
return this},stop:function(){for(var a=this.B;a<=this.z;a++)this.G(a).stop();return this},w:function(){for(var a=[],b=0,d=this.ka.length;b<d;b++)a=a.concat(this.ka[b].w());return a},Xa:function(b){a.a(b,"listener cannot be null");this.gb.add(b);return this},Db:function(b){a.a(b,"listener cannot be null");this.gb.remove(b);return this},K:function(b){a.a(b,"listener cannot be null");this.S.add(b);return this},Da:function(b){a.a(b,"listener cannot be null");this.S.remove(b);return this},Za:function(b){a.a(b,
"listener cannot be null");this.lb.add(b);return this},Fb:function(b){a.a(b,"listener cannot be null");this.lb.remove(b);return this},ha:function(b){a.a(b,"listener cannot be null");this.wb.add(b);return this},Ea:function(b){a.a(b,"listener cannot be null");this.wb.remove(b);return this},$a:function(b){a.a(b,"listener cannot be null");this.pb.add(b);return this},Gb:function(b){a.a(b,"listener cannot be null");this.pb.remove(b);return this},Ya:function(b){a.a(b,"listener cannot be null");this.Ja.add(b);
return this},Eb:function(b){a.a(b,"listener cannot be null");this.Ja.remove(b);return this},bb:function(b){a.a(b,"listener cannot be null");this.vb.add(b);return this},Ib:function(b){a.a(b,"listener cannot be null");this.vb.remove(b);return this},ab:function(b){a.a(b,"listener cannot be null");this.qb.add(b);return this},Hb:function(b){a.a(b,"listener cannot be null");this.qb.remove(b);return this}};return k});n("sdk/streamdata/SortedMap",["sdk/utils/Preconditions"],function(a){function e(b){a.a(b,
"comparator cannot be null");this.mb={};this.C=[];this.cd=b}e.prototype={add:function(a,e){var k=this.mc(e);this.mb[a]=e;this.C.splice(k,0,e);return k},remove:function(a){var e=this.gc(this.get(a));this.C.splice(e,1);this.mb[a]=o;return e},update:function(a,e){var k=this.get(a),h=this.gc(k);this.C.splice(h,1);for(var j in e)k[j]=e[j];j=this.mc(k);this.C.splice(j,0,k);return{Hc:h,Lb:j,value:k}},get:function(a){return this.mb[a]},gc:function(a){return this.C.indexOf(a)},mc:function(a){for(var e,k,h=
0,j=this.C.length-1;h<=j;)if(e=h+j>>1,k=this.cd(this.C[e],a),0>k)h=e+1;else if(0<k)j=e-1;else return e;return e==o?0:0<k?e:e+1}};return e});n("sdk/streamdata/Bucket",["sdk/utils/Preconditions","sdk/utils/Logger","sdk/streamdata/SortedMap","sdk/utils/Utils"],function(a,e,b,f){function k(c,d,e,g,i,f,h,l){a.a(c,"bucketId cannot be null");a.a(d,"revision cannot be null");this.m=c;this.F=d;this.va=g;this.N=i;this.Yb=f;this.xc=h;this.oc=l||u;this.q=[];if(e&&this.va&&this.N){this.A=new b(r(this.N));c=0;
for(d=e.length;c<d;c++)g=e[c],i=g._identifier,g&&i?this.A.add(i,g):m(Error("rows are not consistent"))}}var h,j,d,g,l,c,t;function i(c){var a={},b;for(b in c)c.hasOwnProperty(b)&&(a[b]=c[b]);return a}function s(c){for(var a=[],b=0;b<c.length;b++)a.push(i(c[b]));return a}function r(c){for(var a=[],b=0,e=c.length;b<e;b++){var g=c[b];g.order==j?a.push(x(g.column)):g.order==d?a.push(w(g.column)):m(Error("Unexcepted order="+g.order))}return z(a)}function z(c){return function(a,b){for(var d=0;d<c.length;d++){var e=
(0,c[d])(a,b);if(0!=e)return e}return 0}}function x(c){return function(a,b){var d=a[c],e=b[c];return d==e?0:d<e?-1:1}}function w(c){return function(a,b){var d=a[c],e=b[c];return d==e?0:d>e?-1:1}}k.prototype={Ua:A("m"),Va:A("F"),Lc:A("va"),Kc:A("N"),w:function(){return this.A&&this.A.C},Nc:A("oc"),Bc:function(c){a.a(c,"listenersRegistry cannot be null");a.c(-1==this.q.indexOf(c),"listenersRegistry already exists");if(this.A){for(var b=this.A.C,d=0,e=b.length;d<e;d++)c.Xc(this.m,-1,this.F,{},d,i(b[d]));
c.Vc(this.m,-1,this.F,{},s(b))}this.q.push(c)},Fc:function(c){a.a(c,"listenersRegistry cannot be null");c=this.q.indexOf(c);a.c(0<=c,"listenersRegistry not exists");this.q.splice(c,1)},Ac:function(b){a.a(b,"changeSet cannot be null");a.c(b.revision>=this.F,"inconcistent revision");e.debug("Bucket({0}) applying change set: {1}",this.m,b);this.$=b.revision;for(var d=0,f=b.modifications.length;d<f;d++){var h=b.modifications[d];switch(h.type){case g:this.md(h);break;case l:this.nd(h);break;case c:this.ld(h);
break;case t:this.kd(h);break;default:m(Error("unknown type: "+h.type))}}this.zd(s(this.A.C),i(this.va));this.xc=Date.now();this.F=this.$;e.debug("Bucket({0}) committed change set.",this.m)},kd:function(c){var d=c.properties._schema,g=c.properties._sort,i=c.properties._persistent;e.debug("Bucket({0}) create table: {1}",this.m,c);if(this.A){c=this.A.C;e.debug("Bucket({0}) table already exists. Bucket needs to be reset.",this.m);for(c=c.length-1;0<=c;c--)this.qc(c)}this.va={_identifier:q};this.N=[];
this.Yb=Date.now();this.oc=i;for(var f in d)d.hasOwnProperty(f)&&(this.va[f]=q);c=0;for(d=g.length;c<d;c++)i=g[c].split(" "),f=i[0],i=i[1],a.a(f,"columnName cannot be null"),a.a(i,"order cannot be null"),this.N.push({column:f,order:i});0==this.N.length&&this.N.push({column:"_identifier",order:j,type:h});this.A=new b(r(this.N))},md:function(c){var a;e.debug("Bucket({0}) insert row: {1}",this.m,c);a={_identifier:c.identifier};var b=c.properties,d;for(d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);this.Ad(this.A.add(c.identifier,
a),i(a))},nd:function(c){var a;e.debug("Bucket({0}) update row: {1}",this.m,c);a=this.A.update(c.identifier,c.properties);a.Hc!=a.Lb&&this.Bd(a.Hc,a.Lb);this.Cd(a.Lb,i(a.value),c.properties)},ld:function(c){e.debug("Bucket({0}) delete row: {1}",this.m,c);this.qc(this.A.remove(c.identifier))},zd:function(c){for(var a=0,b=this.q.length;a<b;a++)this.q[a].Vc(this.m,this.F,this.$,{},c)},Ad:function(c,a){for(var b=0,d=this.q.length;b<d;b++)this.q[b].Xc(this.m,this.F,this.$,{},c,a)},Bd:function(c,a){for(var b=
0,d=this.q.length;b<d;b++)this.q[b].De(this.m,this.F,this.$,{},c,a)},Cd:function(c,a,b){for(var d=0,e=this.q.length;d<e;d++)this.q[d].Ee(this.m,this.F,this.$,{},c,a,b)},qc:function(c){for(var a=0,b=this.q.length;a<b;a++)this.q[a].Ce(this.m,this.F,this.$,{},c)}};k.EMPTY={Ua:function(){return""},Va:function(){return-1},Lc:f.Ca,Kc:f.Ca,w:f.Ca,Bc:f.Ca,Fc:f.Ca,Nc:function(){return u},Ac:function(){m(Error("Cannot apply changeSet to a empty bucket."))}};g=1;l=2;c=3;t=4;j="ASC";d="DESC";h=3;return k});n("sdk/streamdata/BucketManager",
["sdk/streamdata/Bucket","sdk/utils/Preconditions","sdk/utils/Logger","sdk/streamdata/SortedMap","sdk/utils/MotwinError"],function(a,e,b,f,k){function h(a,d,c,f){var i=this;e.a(a,"clientChannel cannot be null");e.a(c,"query cannot be null");e.a(f,"terminatedCallback cannot be null");i.i=c;i.Qd=f;i.d=a;i.aa=d;i.e=o;i.k=o;i.j=u;i.t=u;i.n=[];i.ic=-1;i.Tb=function(c){c=c.content;if(i.e&&i.e==c.identifier)try{var a=c.changeSet;b.debug("ClientChannel({0}) query '{1}' received changes.",i.d.name,i.i);c.bucketId!=
i.k.Ua()&&(b.debug("ClientChannel({0}) query '{1}' creating a new bucket.",i.d.name,i.i),i.Ed(c.bucketId));var d=i.k;d.Ac(a);setTimeout(function(){var c=d.Va();if(c>i.ic){i.ic=c;i.Gd(d)}},0);if(!i.t){i.t=p;for(var a=0,e=i.n.length;a<e;a++)i.n[a].Yc({})}}catch(g){b.error("ClientChannel({0}) query '{1}' unable to process changes {2}: {3}",i.d.name,i.i,c,g),i.hc("unable to process ContinuousResponse",g)}};i.bc=function(c){if((c=c.content)&&21==c.code)c=c.content,i.e&&i.e==c.identifier&&i.Md(c.message,
c)};i.Vb=function(){i.vc()};i.$b=function(){if(i.t){for(var c=0,a=i.n.length;c<a;c++)i.n[c].Jb({cause:"disconnected"});i.t=u}}}var j=1,d=[1,0];h.prototype={P:A("j"),Wa:A("t"),Td:function(a){e.a(a,"listenersRegistry cannot be null");var d,c=this.t,f=-1==this.n.indexOf(a);b.debug("ClientChannel({0}) query '{1}' add registration for {2}.",this.d.name,this.i,a);f?(d=0==this.n.length,this.n.push(a),this.k&&this.Sb(a)):d=u;d&&(b.debug("ClientChannel({0}) query '{1}' starting...",this.d.name,this.i),this.j=
p,this.qd(),this.d.Ga("changes",this.Tb),this.d.Ga("exception",this.bc),this.d.Rc(this.Vb),this.d.Sc(this.$b),this.d.s&&this.vc());f&&c&&a.Yc({})},Zc:function(a){e.a(a,"listenersRegistry cannot be null");var d;d=this.n.indexOf(a);var c=0<=d,f=this.t;b.debug("ClientChannel({0}) query '{1}' remove registration for {2}.",this.d.name,this.i,a);c?(this.n.splice(d,1),this.k&&this.Zb(a),d=0==this.n.length):d=u;d&&(b.debug("ClientChannel({0}) query '{1}' stopping...",this.d.name,this.i),this.d.Mb("changes",
this.Tb),this.d.Mb("exception",this.bc),this.d.Pc(this.Vb),this.d.Qc(this.$b),this.d.s&&(this.t=u,this.Ld()),this.e=o,this.wc(),this.j=u,this.Qd());c&&f&&a.Jb({cause:"stopped"})},qd:function(){e.c(!this.k,"bucket cannot be initialized on loading");b.debug("ClientChannel({0}) query '{1}' reloading...",this.d.name,this.i);try{(this.k=this.aa.restore(this.i))?b.debug("ClientChannel({0}) query '{1}' reloaded using persister.",this.d.name,this.i):(this.k=a.EMPTY,b.debug("ClientChannel({0}) query '{1}' cannot found matching metadata in persister.",
this.d.name,this.i))}catch(d){b.warn("ClientChannel({0}) query '{1}' cannot be reload from persister: {2}",this.d.name,this.i,d),this.k=a.EMPTY}this.Rb()},Gd:function(a){e.a(a,"bucket cannot be null");try{b.debug("ClientChannel({0}) query '{1}' persisting...",this.d.name,this.i),this.aa.xe(this.i,a),b.debug("ClientChannel({0}) query '{1}' persisted.",this.d.name,this.i)}catch(d){b.debug("ClientChannel({0}) query '{1}' unable to persist: {2}",this.d.name,this.i,d),this.hc("unable to persist",d)}},
Ed:function(b){e.a(b,"bucketId cannot be null to replace");e.c(this.k,"bucket must be initialized to unload");this.wc();this.aa.clear(this.i);this.k=new a(b,-1,o,o,o,o,o,u);this.Rb()},wc:function(){e.c(this.k,"bucket must be initialized to unload");this.jd();this.k=o},Sb:function(a){this.k.Bc(a)},Zb:function(a){this.k.Fc(a)},Rb:function(){e.c(this.k,"bucket must be initialized to attach");for(var a=0,b=this.n.length;a<b;a++)this.Sb(this.n[a])},jd:function(){e.c(this.k,"bucket must be initialized to detach");
for(var a=0,b=this.n.length;a<b;a++)this.Zb(this.n[a])},vc:function(){b.debug("ClientChannel({0}) query '{1}' sending start...",this.d.name,this.i);this.e=++j;this.d.sendMessage("query.start",{_classname:"Query",streamDataProtocolVersion:d,identifier:this.e,queryString:this.i.O,positionalParameters:this.i.ba,namedParameters:this.i.Z,bucketId:this.k.Ua(),revision:this.k.Va()},{guaranteedDelivery:u})},Ld:function(){e.c(this.j,"controller is not started");b.debug("ClientChannel({0}) query '{1}' sending stop...",
this.d.name,this.i);this.d.sendMessage("query.stop",this.e,{guaranteedDelivery:u})},hc:function(a,d){var c=[],e=new k("client","error",a,d,p);b.error("ClientChannel({0}) query '{1}' terminating because internal error: {2}",this.d.name,this.i,d);try{this.aa.clear(this.i)}finally{for(var f=0,h=this.n.length;f<h;f++){var j=this.n[f];c.push(j);this.Zc(j)}f=0;for(h=c.length;f<h;f++)j=c[f],j.Wc({},e)}},Md:function(a,b){var c=new k("server","error",a,b,u);this.t=u;for(var d=0,e=this.n.length;d<e;d++){var f=
this.n[d];f.Wc({},c);f.Jb({cause:"error"})}}};return h});var H=function(){function a(c){return"string"==typeof c?c:typeof c.ga==g?(c=c.ga(),"string"==typeof c?c:a(c)):typeof c.toString==g?c.toString():""+c}function e(c,a){return c.V(a)}function b(c,a){return typeof a.V==g?a.V(c):c===a}function f(c){return function(a){a===q&&m(Error("null is not a valid "+c));"undefined"==typeof a&&m(Error(c+" must not be undefined"))}}function k(c,a,b,d){this[0]=c;this.u=[];this.zc(a,b);d!==q&&(this.Jc=function(){return d})}
function h(c){return function(a){for(var b=this.u.length,d,e=this.Jc(a);b--;)if(d=this.u[b],e(a,d[0]))switch(c){case i:return p;case s:return d;case r:return[b,d[1]]}return u}}function j(c,a){var b=c[a];return b&&b instanceof k?b:q}function d(b,e){function f(c){return function(){for(var a=[],b=h.length;b--;)h[b][c](a);return a}}var i=this,h=[],s={},r=typeof b==g?b:a,n=typeof e==g?e:q;this.put=function(a,b){c(a);t(b);var d=r(a),e,f=q;(e=j(s,d))?(d=e.Ic(a))?(f=d[1],d[1]=b):e.zc(a,b):(e=new k(d,a,b,
n),h[h.length]=e,s[d]=e);return f};this.get=function(a){c(a);var b=r(a);if(b=j(s,b))if(a=b.Ic(a))return a[1];return q};this.Cc=function(a){c(a);var b=r(a);return(b=j(s,b))?b.Cc(a):u};this.Dc=function(c){t(c);for(var a=h.length;a--;)if(h[a].Dc(c))return p;return u};this.clear=function(){h.length=0;s={}};this.keys=f("keys");this.u=f("getEntries");this.remove=function(a){c(a);var b=r(a),d=q,e=j(s,b);if(e&&(d=e.He(a),d!==q&&!e.u.length)){a:{for(a=h.length;a--;)if(e=h[a],b===e[0])break a;a=q}l(h,a);delete s[b]}return d};
this.size=function(){for(var c=0,a=h.length;a--;)c+=h[a].u.length;return c};this.Ge=function(c){for(var c=c.u(),a,b,d,e=c.length,f="undefined"==g;e--;){a=c[e];b=a[0];a=a[1];if(f&&(d=i.get(b)))a=o(b,d,a);i.put(b,a)}};this.J=function(){var c=new d(b,e);c.Ge(i);return c}}var g="function",l=typeof Array.prototype.splice==g?function(c,a){c.splice(a,1)}:function(c,a){var b,d,e;if(a===c.length-1)c.length=a;else{b=c.slice(a+1);c.length=a;d=0;for(e=b.length;d<e;++d)c[a+d]=b[d]}},c=f("key"),t=f("value"),i=
0,s=1,r=2;k.prototype={Jc:function(c){return typeof c.V==g?e:b},Ic:h(s),$d:h(r),He:function(c){return(c=this.$d(c))?(l(this.u,c[0]),c[1]):q},zc:function(c,a){this.u[this.u.length]=[c,a]},keys:function(c){return function(a){for(var b=a.length,d=0,e=this.u.length;d<e;++d)a[b+d]=this.u[d][c]}}(0),Cc:h(i),Dc:function(c){for(var a=this.u.length;a--;)if(c===this.u[a][1])return p;return u}};return d}();n("Hashtable",function(a){return function(){return function(){return this.Qe||H}.apply(a,arguments)}}(this));
n("sdk/streamdata/BucketRegistry",["sdk/streamdata/BucketManager","sdk/utils/Preconditions","sdk/utils/Logger","Hashtable"],function(a,e,b,f){function k(a,b){e.a(a,"clientChannel cannot be null");e.a(b,"persister cannot be null");this.d=a;this.aa=b;this.fb=new f}k.prototype={start:function(a,b){var d=this.dc(a,p);d.Td(b);return d},stop:function(a,b){var d=this.dc(a,u);d&&d.Zc(b);return d},dc:function(b,e){var d=this,f=d.fb.get(b);!f&&e&&(f=new a(d.d,d.aa,b,function(){d.fb.remove(b)}),d.fb.put(b,f));
return f}};return k});n("sdk/requesting/RequestHolder",["sdk/utils/Preconditions","sdk/utils/Logger","sdk/utils/MotwinError","sdk/utils/Callbacks"],function(a,e,b,f){function k(b,d,e,l){a.a(b,"clientChannel cannot be null");a.a(d,"type cannot be null");a.a(l,"disposeFunction cannot be null");this.identifier=h++;this.$c=new f(u,b);this.Ta=new f(u,b);this.d=b;this.r=d;this.fd=e===o?q:e;this.Qa=q;this.M=u;this.Ka=l}var h=1;k.prototype={Ba:function(){return{_classname:"Request",identifier:this.identifier,
type:this.r,content:this.fd}},Ae:function(a){this.M||(this.M=p,this.Kb(),this.$c.set([this.Ba(),a]),this.Ka(this.identifier))},ze:function(a){this.M||(this.M=p,this.Kb(),this.Ta.set([this.Ba(),new b("server","error","receive error from server",a,u)]),this.Ka(this.identifier))},ye:function(a){this.M||(this.M=p,this.Kb(),this.Ta.set([this.Ba(),new b("client","error","error sending request",a,u)]),this.Ka(this.identifier))},Be:function(){this.M||(this.M=p,this.Ta.set([this.Ba(),new b("client","timeout",
"timeout sending request",q,u)]),this.Ka(this.identifier))},Me:function(b){a.a(b,"timeout cannot be null");a.fa(0<b,"timeout must be higher than 0");var d=this;d.Qa=setTimeout(function(){d.Be()},b)},Kb:function(){this.Qa&&(clearTimeout(this.Qa),this.Qa=o)}};return k});n("sdk/requesting/RequestManager",["sdk/requesting/RequestHolder","sdk/utils/Deferred","sdk/utils/Preconditions","sdk/utils/Logger"],function(a,e,b,f){function k(a){var e=this;b.a(a,"clientChannel cannot be null");e.d=a;e.Na={};e.d.Ga("response",
function(a){b.c("response"==a.type,"message type must be response");b.c(a.content&&a.content._classname&&"Response"==a.content._classname,"message content must be a Response class");var a=a.content,g=e.Na[a.identifier];g?g.Ae(a):f.error("ClientChannel({0}) ignoring unknown response {1}.",e.d.name,a)});e.d.Ga("exception",function(a){b.c("exception"==a.type,"exception type must be response");b.c(a.content&&a.content._classname&&"Exception"==a.content._classname,"message content must be a Exception class");
if((a=a.content)&&20==a.code){var a=a.content,g=e.Na[a.identifier];g?g.ze(a):f.error("ClientChannel({0}) ignoring unknown response error {1}.",e.d.name,a)}})}k.prototype={Je:function(f,j,d){b.a(f,"type cannot be null");var d=d||{},g=this,l,c=d.timeout||2E4;l=new a(g.d,f,j,function(a){delete g.Na[a]});g.Na[l.identifier]=l;g.d.sendMessage("request",l.Ba(),{guaranteedDelivery:d.guaranteedDelivery==u?u:p,ttl:0<=d.ttl?d.ttl:c}).K(function(a){l.ye(a)});l.Me(c);return new e(l.$c,l.Ta)}};return k});n("sdk/network/AbstractWebSocketConnector",
["sdk/utils/Logger"],function(a){function e(e,k,h,j){var d=this,g=p;d.r=e;d.da=h;d.h=j;d.e=b++;a.debug("{0}Connector({1}) connecting...",d.r,d.e);d.l=k();d.l.onopen=function(){if(d.l&&g){g=u;a.debug("{0}Connector({1}) opened.",d.r,d.e);try{d.h.Tc()}catch(b){d.h.v(b)}}};d.l.onmessage=function(b){if(d.l&&!g)try{var c=JSON.parse(b.data);a.debug("{0}Connector({1}) received data: {2}",d.r,d.e,c);d.h.Ec(c)}catch(e){d.h.v(e)}else m(Error("cannot receive message because is connecting or is closed"))};d.l.onclose=
function(){if(d.l){a.debug("{0}Connector({1}) closed.",d.r,d.e);d.l=q;try{d.h.closed()}catch(b){d.h.v(b)}}};d.l.onerror=function(b){if(d.l){a.debug("{0}Connector({1}) closed due to exception caught: {2}.",d.r,d.e,b);b=d.l;d.l=q;(b.readyState==d.da.OPEN||b.readyState==d.da.CONNECTING)&&b.close();try{d.h.closed()}catch(c){d.h.v(c)}}}}var b=1;e.prototype={close:function(){if(this.l){a.debug("{0}Connector({1}) closing...",this.r,this.e);var b=this.l;if(b.readyState==this.da.OPEN||b.readyState==this.da.CONNECTING){this.l=
q;try{this.h.closed()}catch(e){this.h.v(e)}b.close()}}else a.debug("{0}Connector({1}) already closed.",this.r,this.e)},send:function(b){if(this.l){a.debug("{0}Connector({1}) sending data: {2}.",this.r,this.e,b);try{this.l.send(JSON.stringify(b))}catch(e){this.h.v(e)}}else a.debug("{0}Connector({1}) cannot sent to a closed connection.",this.r,this.e)},Aa:function(){return this.l&&(this.l.readyState==this.da.OPEN||this.l.readyState==this.da.CONNECTING)}};return e});n("externs/WebSocket",[],function(){return window.WebSocket||
window.MozWebSocket});n("sdk/network/WebSocketConnector",["sdk/network/AbstractWebSocketConnector","externs/WebSocket"],function(a,e){return function(b,f,k){e||m(Error("No WebSocket implementation found."));return new a("WebSocket",function(){return new e(b)},e,k)}});n("externs/Cordova",[],function(){return window.cordova});n("sdk/network/CordovaSocketConnector",["sdk/utils/Logger","externs/Cordova"],function(a,e){function b(b,c,t){var i=this;i.R=p;i.H=u;i.Ra=b;i.Nd=c;i.e=g++;i.h=t;a.debug("CordovaConnector({0}) connecting to '{1}' throught {2}...",
i.e,b,c);e.exec(function(c){var b=c[0],c=c[1];if(b==d)if(!i.R&&!i.H){b=c.data;a.debug("CordovaConnector({0}) received data: {1}",i.e,b);try{i.h.Ec(b)}catch(e){i.h.v(e)}}else m(Error("cannot receive message because is connecting or is closed"));else if(b==j)if(i.R){b=c.remoteIp;i.R=u;a.debug("CordovaConnector({0}) opened to {1}.",i.e,b);try{i.h.Tc(b)}catch(f){i.h.v(f)}}else a.debug("CordovaConnector({0}) received callback but is already opened.",i.e);else if(b==h)if(i.H)a.debug("CordovaConnector({0}) received callback but is already closed.",
i.e);else{a.debug("CordovaConnector({0}) closed.",i.e);i.R=u;i.H=p;try{i.h.closed()}catch(g){i.h.v(g)}}else m(Error("unknown callback action"+b))},function(c){if(!i.H){a.debug("CordovaConnector({0}) caught error: {1}.",i.e,c);i.R=u;i.H=p;try{i.h.closed()}catch(b){i.h.v(b)}}},f,k,[i.e,i.Ra,i.Nd])}var f="MotwinConnectorPlugin",k="open",h="closed",j="opened",d="received",g=1;b.prototype={close:function(){var b=this;if(b.H)a.debug("CordovaConnector({0}) already closed.",b.e);else{a.debug("CordovaConnector({0}) closing...",
b.e);b.R=u;b.H=p;try{b.h.closed()}catch(c){b.h.v(c)}try{e.exec(v(),function(c){a.debug("CordovaConnector({0}) caught error closing connection: {1}.",b.e,c)},f,"close",[b.e])}catch(d){b.h.v(d)}}},send:function(b){var c=this;if(!c.R&&!c.H){a.debug("CordovaConnector({0}) sending data: {1}.",c.e,b);try{var d=JSON.stringify(b);e.exec(v(),function(){c.close()},f,"send",[c.e,d])}catch(g){c.h.v(g)}}else a.debug("CordovaConnector({0}) cannot sent to a closed connection.",c.e)},Aa:function(){return!this.H}};
return b});n("externs/SockJS",[],function(){return window.SockJS});n("sdk/network/SockJsConnector",["sdk/network/AbstractWebSocketConnector","externs/SockJS"],function(a,e){return function(b,f,k,h){e||m(Error("SockJS is not found. The SockJs library (0.3.4) needs to be included to your html page."));return new a("SockJs",function(){return new e(b,o,h)},e,k)}});n("sdk/streamdata/Persister",["sdk/streamdata/Bucket","sdk/streamdata/Query","sdk/utils/Preconditions","sdk/utils/Logger","sdk/utils/Utils"],
function(a,e,b,f,k){function h(a,e,i){b.a(a,"storageIdentifier cannot be null");b.a(e,"temporaryStorage cannot be null");b.a(i,"persistentStorage cannot be null");b.c("function"===typeof e.clear,"temporaryStorage has no clear function");b.c("function"===typeof e.setItem,"temporaryStorage has no setter function");b.c("function"===typeof e.getItem,"temporaryStorage has no getter function");b.c("function"===typeof e.removeItem,"temporaryStorage has no remove function");b.c("function"===typeof i.clear,
"persistentStorage has no clear function");b.c("function"===typeof i.setItem,"persistentStorage has no setter function");b.c("function"===typeof i.getItem,"persistentStorage has no getter function");b.c("function"===typeof i.removeItem,"persistentStorage has no remove function");var h=k.Vd(a);this.Pd=e;this.td=i;this.sa=d+j+h+j;this.ob=this.sa+g+j;this.Ia=this.sa+l+j;f.debug("BucketManager initializing localeStorage...");this.hb(p,a);this.hb(u,a)}var j="::",d="bucket",g="metadata",l="data";h.prototype=
{xe:function(a,d){var e={},f={};e.rows=d.w();e.schema=d.Lc();e.orderBy=d.Kc();f.bucketId=d.Ua();f.revision=d.Va();f.createdAt=d.Yb;f.updatedAt=d.xc;f.persistent=d.Nc();f.query={};f.query.queryString=a.O;f.query.positionalParameters=a.ba;f.query.namedParameters=a.Z;this.Pa(f.persistent,this.Ia+f.bucketId,e);e=this.Hd(a,f);b.c(e==q||e.persistent==f.persistent,"Bucket isPersistent value have change. This behavior is not supported.");e&&e.bucketId!=f.bucketId&&this.Oa(e.persistent,this.Ia+e.bucketId)},
restore:function(c){var c=this.rd(c),b=q;c&&(b=this.ma(c.persistent,this.Ia+c.bucketId),b=new a(c.bucketId,c.revision,b.rows,b.schema,b.orderBy,c.createdAt,c.updatedAt,c.persistent));return b},clear:function(a){(a=this.Dd(a))&&a.bucketId&&this.Oa(a.persistent,this.Ia+a.bucketId)},Fd:function(a){f.error("BucketManager clearing entire storage (leak of memory?).");this.wa(a).clear();this.hb(a)},rd:function(a){var b=q;(b=this.jc(p,a))||(b=this.jc(u,a));return b},jc:function(a,d){for(var f=this.ob+d.ga(),
f=this.ma(a,f)||[],g=q,h=0,j=f.length;h<j&&!g;h++){var k=f[h],l=k.query,l=new e(l.queryString,l.positionalParameters,l.namedParameters);b.c(k.persistent==a,"loadMetadataFromStorage: persistance status inconsistency");d.V(l)&&(g=k)}return g},Hd:function(a,b){for(var d=this.ob+a.ga(),f=b.persistent,g=this.ma(f,d)||[],h=q,j=0,k=g.length;j<k&&!h;j++){var l=g[j],n=l.query,n=new e(n.queryString,n.positionalParameters,n.namedParameters);a.V(n)&&(g.splice(j,1),h=l)}g.push(b);this.Pa(f,d,g);return h},Dd:function(a){a.ga();
var b=q;(b=this.sc(p,a))||(b=this.sc(u,a));return b},sc:function(a,d){var f=this.ob+d.ga(),g=this.ma(a,f),h=q;if(g)for(var j=0,l=g.length;j<l&&!h;j++){var k=g[j],n=k.query,n=new e(n.queryString,n.positionalParameters,n.namedParameters);b.c(k.persistent==a,"removeMetadataFromStorage: persistance status inconsistency");d.V(n)&&(g.splice(j,1),0==g.length?this.Oa(a,f):this.Pa(k.persistent,f,g),h=k)}return h},hb:function(a,b){var d=this.sa+"storage",e=this.ma(a,d)||q;if(!e||!e.identifier||!e.version||
e.identifier!=b||"2"!=e.version){f.debug("BucketManager initializing storage: {0}...",a?"localStorage":"sessionStorage");var e=this.wa(a),g;for(g in e)e.hasOwnProperty(g)&&g.substring(0,this.sa.length)===this.sa&&this.Oa(a,g);g={};g.identifier=b;g.version="2";this.Pa(a,d,g)}},Pa:function(a,b,d){d=JSON.stringify(d);try{this.wa(a).setItem(b,d)}catch(e){this.Fd(a),m(e)}},ma:function(a,b){var d=this.wa(a).getItem(b);return d&&JSON.parse(d)},Oa:function(a,b){this.wa(a).removeItem(b)},wa:function(a){return a?
this.td:this.Pd}};return h});n("sdk/motwin","sdk/channel/ClientChannel,sdk/streamdata/Query,sdk/streamdata/ContinuousQueryController,sdk/streamdata/WindowedContinuousQueryController,sdk/streamdata/BucketRegistry,sdk/requesting/RequestManager,sdk/utils/Logger,sdk/utils/Deferred,sdk/utils/MotwinError,sdk/utils/Preconditions,sdk/utils/Exporter,sdk/network/WebSocketConnector,sdk/network/CordovaSocketConnector,sdk/network/SockJsConnector,sdk/streamdata/Persister,sdk/utils/Utils,externs/LocalStorage,externs/SessionStorage,externs/ObjectStorage".split(","),
function(a,e,b,f,k,h,j,d,g,l,c,n,i,s,r,z,x,w,y){function C(b,c){a.prototype[b]=c}function E(a,c){if(!this.ia){var d=new r(this.Ra+"::"+this.p.appName+"::"+this.p.appVersion,w||y,x||w||y);this.ia=new k(this,d)}return new b(this,this.ia,a,c)}C("sendRequest",function(a,b,c){if(!this.tc)this.tc=new h(this);return this.tc.Je(a,b,c)});C("createContinuousQuery",E);C("createWindowedContinuousQuery",function(a,b,c){return new f(z.Fe(E,this),a,b,c)});var B={};c.b(B,"Logger",j);c.b(j,"DEBUG",j.cb);c.b(j,"INFO",
j.Pb);c.b(j,"WARN",j.Qb);c.b(j,"ERROR",j.Ob);c.b(j,"setLevel",j.Ke);c.b(j,"debug",j.debug);c.b(j,"info",j.info);c.b(j,"warn",j.warn);c.b(j,"error",j.error);c.b(B,"createClientChannel",function(b,c,d){l.a(b,"uri cannot be null");var e=o;b.lastIndexOf("ws://",0)==0||b.lastIndexOf("wss://",0)==0?e=n:b.lastIndexOf("socket://",0)==0||b.lastIndexOf("zsocket://",0)==0||b.lastIndexOf("ssl://",0)==0||b.lastIndexOf("zssl://",0)==0?e=i:b.lastIndexOf("http://",0)==0||b.lastIndexOf("https://",0)==0?e=s:m(Error("Invalid protocol type for URI: "+
b));e||m(Error("No valid connector found for URI: "+b));return new a(b,c,e,d)});c.b(B,"extendClientChannel",C);c.b(a.prototype,"connect",a.prototype.Ud);c.b(a.prototype,"disconnect",a.prototype.Xd);c.b(a.prototype,"dispose",a.prototype.Yd);c.b(a.prototype,"isConnected",a.prototype.fe);c.b(a.prototype,"isOpened",a.prototype.Mc);c.b(a.prototype,"isStarted",a.prototype.Mc);c.b(a.prototype,"onOpen",a.prototype.re);c.b(a.prototype,"onReject",a.prototype.se);c.b(a.prototype,"onConnect",a.prototype.Rc);
c.b(a.prototype,"onDisconnect",a.prototype.Sc);c.b(a.prototype,"onError",a.prototype.K);c.b(a.prototype,"onUpdateNotification",a.prototype.we);c.b(a.prototype,"offOpen",a.prototype.me);c.b(a.prototype,"offReject",a.prototype.ne);c.b(a.prototype,"offConnect",a.prototype.Pc);c.b(a.prototype,"offDisconnect",a.prototype.Qc);c.b(a.prototype,"offError",a.prototype.Da);c.b(a.prototype,"offUpdateNotification",a.prototype.qe);c.b(a.prototype,"registerMessageProcessor",a.prototype.Ga);c.b(a.prototype,"unregisterMessageProcessor",
a.prototype.Mb);c.b(a.prototype,"sendMessage",a.prototype.sendMessage);c.b(B,"extendContinuousQuery",function(a,c){b.prototype[a]=c});c.b(b.prototype,"start",b.prototype.start);c.b(b.prototype,"stop",b.prototype.stop);c.b(b.prototype,"getRows",b.prototype.w);c.b(b.prototype,"isSynchronized",b.prototype.Wa);c.b(b.prototype,"isStarted",b.prototype.P);c.b(b.prototype,"onChange",b.prototype.Xa);c.b(b.prototype,"onError",b.prototype.K);c.b(b.prototype,"onInsert",b.prototype.Za);c.b(b.prototype,"onUpdate",
b.prototype.ha);c.b(b.prototype,"onUpdate",b.prototype.ha);c.b(b.prototype,"onMove",b.prototype.$a);c.b(b.prototype,"onDelete",b.prototype.Ya);c.b(b.prototype,"onSynchronize",b.prototype.ue);c.b(b.prototype,"onUnsynchronize",b.prototype.ve);c.b(b.prototype,"onSync",b.prototype.bb);c.b(b.prototype,"onOutOfSync",b.prototype.ab);c.b(b.prototype,"offChange",b.prototype.Db);c.b(b.prototype,"offError",b.prototype.Da);c.b(b.prototype,"offInsert",b.prototype.Fb);c.b(b.prototype,"offUpdate",b.prototype.Ea);
c.b(b.prototype,"offUpdate",b.prototype.Ea);c.b(b.prototype,"offMove",b.prototype.Gb);c.b(b.prototype,"offDelete",b.prototype.Eb);c.b(b.prototype,"offSynchronize",b.prototype.oe);c.b(b.prototype,"offUnsynchronize",b.prototype.pe);c.b(b.prototype,"offSync",b.prototype.Ib);c.b(b.prototype,"offOutOfSync",b.prototype.Hb);c.b(f.prototype,"start",f.prototype.start);c.b(f.prototype,"stop",f.prototype.stop);c.b(f.prototype,"startBottom",f.prototype.Le);c.b(f.prototype,"stopBottom",f.prototype.Oe);c.b(f.prototype,
"startTop",f.prototype.Ne);c.b(f.prototype,"stopTop",f.prototype.Pe);c.b(f.prototype,"top",f.prototype.top);c.b(f.prototype,"bottom",f.prototype.bottom);c.b(f.prototype,"offset",f.prototype.G);c.b(f.prototype,"reset",f.prototype.reset);c.b(f.prototype,"getRows",f.prototype.w);c.b(f.prototype,"onChange",f.prototype.Xa);c.b(f.prototype,"onError",f.prototype.K);c.b(f.prototype,"onInsert",f.prototype.Za);c.b(f.prototype,"onUpdate",f.prototype.ha);c.b(f.prototype,"onUpdate",f.prototype.ha);c.b(f.prototype,
"onMove",f.prototype.$a);c.b(f.prototype,"onDelete",f.prototype.Ya);c.b(f.prototype,"onSync",f.prototype.bb);c.b(f.prototype,"onOutOfSync",f.prototype.ab);c.b(f.prototype,"offChange",f.prototype.Db);c.b(f.prototype,"offError",f.prototype.Da);c.b(f.prototype,"offInsert",f.prototype.Fb);c.b(f.prototype,"offUpdate",f.prototype.Ea);c.b(f.prototype,"offUpdate",f.prototype.Ea);c.b(f.prototype,"offMove",f.prototype.Gb);c.b(f.prototype,"offDelete",f.prototype.Eb);c.b(f.prototype,"offSync",f.prototype.Ib);
c.b(f.prototype,"offOutOfSync",f.prototype.Hb);c.b(d.prototype,"onSuccess",d.prototype.te);c.b(d.prototype,"onError",d.prototype.K);c.b(e.prototype,"toJSON",e.prototype.toJSON);c.b(e.prototype,"toString",e.prototype.toString);c.b(g.prototype,"isFatal",g.prototype.ge);c.b(g.prototype,"isServer",g.prototype.he);c.b(g.prototype,"isClient",g.prototype.ee);c.b(g.prototype,"isTimeout",g.prototype.ie);c.b(g.prototype,"getMessage",g.prototype.ae);c.b(g.prototype,"getError",g.prototype.getError);return B});
return y("sdk/motwin")}"function"===typeof define&&define.amd?define(G):D.motwin=G();})();
